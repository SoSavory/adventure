<div id="container" style="width:70%; float:left;">
  <div style="border: 1px solid black; padding: 1em;">
    <%= @story %>
  </div>

  <h1 id="title">
  </h1>

  <div>
    <h2>All Pages</h1>
    <ul id="pages">
    </ul>
  </div>

  <h2 id="levels">
  </h2>

  <h3 id="page_title">
  </h3>

  <p id="text">
  </p>

  <div>
    <h2>Child Pages</h2>
    <ul id="child_pages_list">
    </ul>
  </div>

</div>


<div id="form_area" style="width: 20%; float:right; border:1px solid black;">
</div>




<script>
  $story = JSON.parse(<%= raw @story.to_json %>);
  $('#title').html($story.title);

  $start_page = $story.pages.filter(function(val) {
    return val.level === $story.levels[0];
  })[0];

  $current_page = $start_page;

  function setCurrentPage(id){
    $current_page = $story.pages.filter(function(val) {
      return val.id === id;
    })[0];
    setPageTitle($current_page);
    setChildPages($current_page);
    setCurrentText($current_page);
  };

  function setPageTitle(page){
    $("#page_title").html(page.title);
  };

  function setChildPages(page){
    $("#child_pages_list").html("");
    $child_pages = $story.pages.filter(function(val) {
      return val.parent_id === page.id;
    });
    $.each($child_pages, function() {
      $("#child_pages_list").append("<li onClick='setCurrentPage(" + this.id + ")'>" + this.title + "</li>");
    });
  };

  function setCurrentText(page){
    $("#text").html(page.text);
  };

  $.each($story.pages, function() {
    $("#pages").append("<li onClick='setCurrentPage(" + this.id + ")'>" + this.title + "</li>");
  });
</script>
